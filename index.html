<!DOCTYPE html>
<html>
<body>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<link rel="stylesheet" type="text/css" href="stylesheet.css">

<div id="my_dataviz"></div>
<script>

// set the dimensions and margins of the graph
var margin = {top: 100, right: 30, bottom: 30, left: 250},
    width = 1500 - margin.left - margin.right,
    height = 800 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read the data
d3.csv("https://raw.githubusercontent.com/milan-saroj/Narrative_Visualization/master/US_cases__.csv",

  // When reading the csv, I must format variables:
  function(d){
    return { date : d3.timeParse("%m/%d/%Y")(d.date), US_cases : d.US_cases }
  },

  // Now I can use this dataset:
  function(data) {

    // Add X axis --> it is a date format
    var x = d3.scaleTime()
      .domain([new Date("1/21/2020"), new Date("7/16/2020")])
      .range([ 0, width ]);

   svg.append("g").attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%m/%d")));

    // Add Y axis
    var y = d3.scaleLinear()
      .domain([0,4000000])
      .range([ height, 0 ]);

    svg.append("g")
      .call(d3.axisLeft(y).tickFormat(d3.format(".2s")));

      var line = d3.line()
      .x(function(d) { return x(d.date) })
      .y(function(d) { return y(d.US_cases) })
        .curve(d3.curveMonotoneX);

      var line2 = d3.line()
        .x(function(d) { return x(d.date) })
        .y(function(d) { return y(d.US_death) })
          .curve(d3.curveMonotoneX);


    // Add the line
    svg.append('g').append("path")
      .datum(data)
      .attr("class", "line")
      .attr("d", line)
      .transition()
      .ease(d3.easeSin)
      .duration(2000)
      .style('stroke', "red")
      .attr('stroke-width', 5)
      .attr('fill',"None");


    svg.append('g')
      .append("path")
      .datum(data)
      .attr("class", "line")
      .attr("d", line2).transition()
      .ease(d3.easeSin)
      .duration(4000)
      .style('stroke', "blue")
      .attr('stroke-width', 5);

    svg.append('text')
      .attr('y',-20)
      .attr('x',430)
      .attr('class', 'title')
      .text('COVID-19 Cases in USA')

    svg.append('text')
      .attr('y',-60)
      .attr('x',-330)
      .attr('class', 'title')
      .text('COVID-19 Cases')
  		.style('font-size',18)
      .attr("transform",
            "rotate(-90)")
      .attr('text-anchor','middle')

      const annotations = [
    {
    note: {
      title:"March 13,2020",
      label: "POTUS declare National Emergency"
    },
    connector: {
      end: "dot",        // none, or arrow or dot
      type: "line",       // Line or curve
      points: 3,           // Number of break in the curve
      lineType : "horizontal"
    },
    color: ["#69b3a2"],
    x: x(new Date("3/13/2020")),  // Takes the pixel number to convert to number
    y:  y(2224),
    dy: -100,
    dx: -120
  },
  {
  note: {
    title:"April 11,2020",
    label: "Major disaster declaration in all 50 states(first time in US history)"
  },
  connector: {
    end: "dot",         // none, or arrow or dot
    type: "line",       // Line or curve
    points: 3,           // Number of break in the curve
    lineType : "horizontal"
  },
  color: ["#69b3a2"],
  x: x(new Date("4/13/2020")),  // Takes the pixel number to convert to number
  y:  y(584018),
  dy: -100,
  dx: 20
},
{
note: {
  title:"March 23,2020",
  label: "Stock Market hit 3-year low"
},
connector: {
  end: "dot",        // none, or arrow or dot
  type: "line",       // Line or curve
  points: 3,           // Number of break in the curve
  lineType : "horizontal"
},

x: x(new Date("3/23/2020")),  // Takes the pixel number to convert to number
y:  y(43505),
dy: -100,
dx: -30
},
{
note: {
  title:"May 26,2020",
  label: "Beginning of Protest over death of George Floyd"
},
connector: {
  end: "dot",        // none, or arrow or dot
  type: "line",       // Line or curve
  points: 3,           // Number of break in the curve
  lineType : "horizontal"
},
x: x(new Date("5/26/2020")),  // Takes the pixel number to convert to number
y:  y(1689248),
dy: -100,
dx: -30
},
{
note: {
  title:"May 31,2020",
  label: "Memorial Day:Coronavirus hospitalizations rise sharply after Holiday"
},
connector: {
  end: "dot",        // none, or arrow or dot
  type: "line",       // Line or curve
  points: 3,           // Number of break in the curve
  lineType : "horizontal"
},
x: x(new Date("5/31/2020")),  // Takes the pixel number to convert to number
y:  y(1799035),
dy: -130,
dx: 80
},




    ]

    const makeAnnotations = d3.annotation()
         .type(d3.annotationLabel)
         .annotations(annotations)

       svg.append("g")
         .attr("class", "annotation-group")
         .call(makeAnnotations)
})

</script>
